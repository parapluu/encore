embed
body
__thread unsigned seed;
end

-- Random number generator with thread-local seed
def random(max:int) : int
  embed int
    if (seed == 0)
      {
        seed = (unsigned) time(NULL);
      }
    rand_r(&seed) % #{max};
  end    
    
-- Simple random number generator encapsulating a seed of its own
passive class Random
  seed:embed unsigned int end
  -- Trace funcition required because of the embed type of seed
  def Random_trace() : void
    ()
  -- Initialisation always with a seed
  def init(seed:int) : void
    embed void
      _this->_enc__field_seed = (unsigned) #{seed};
    end
  -- Returns random % max
  def random(max:int) : int
    embed int
      rand_r((unsigned *) &(_this->_enc__field_seed)) % #{max};
    end
    
