


{-
	   Requests for docuemntation.
		How are formatting actually done.
		Are { neccesary
		Return type of init ???
		Type inference ??
		Scoping ?
	 	Type casting ?
	 	Basic synax (loops and such)
	 		just the grammar is not cool
	 	
-}


{-
	Draws the mandelbrot set from  -1.5-i to 1.5+i on a N by N thing

-}
class Main
	def main() : void{
			--print "computing mandelbrots like a boss ";
			let 
				N = 50 : int
				list = new List			
			    argc = embed int argc; end
			    argv1 = embed int atoi(argv[1]); end
			

			in{
			
				list = this.create_list(argv1);
				if(argc == 3) then{
					get list.print(argv1);
				}else{
					print "finished"
				}
				
			}
			
		}
		
	def create_list(N : int) : List{
		let
			x_max = 1.5
			x_min = -1*1.5
			y_max = 1.0
			y_min = -1*1.0
			x = 0.0
			y = 0.0
			dx = 0.0
			dy = 0.0
			iterations = 100
			list = new List()
		in{
			dx = (x_max - x_min) / N;
			dy = (y_max - y_min) / N;
			x = x_min;
			y = y_min;
			while (y < y_max){
				while(x < x_max){
					get list.insert(new Point(x,y,iterations));
					x = x + dx;
				};
				x = x_min;
				y = y + dy;
			};
			
			list
			
		}
		
	
	}
	

		
class Point
	x0 : real
	y0 : real
	color : real
	max_iterations : int
	
	
	def init(x0 : real ,y0 : real,  N : int) : void {
		this.x0 = x0;
		this.y0 = y0;
		this.color = -1*1.0;
		this.max_iterations = N;
	}
	
	def print_point() : void {
		print("(({},{}),{})\n", this.x0, this.y0, this.color);
	}
	
	--currently just computes membership
	def compute_color() : int{
		let
			x = 0.0 : real
			xtemp = 0.0 : real
			y = 0.0 : real
			iteration = 0 : int
			
		in{
			while ((x*x + y*y < 4.0) and (iteration <= this.max_iterations)){
				xtemp = x*x - y*y + this.x0;
				y = 2.0*x*y + this.y0;
				x = xtemp;
				iteration = iteration + 1;
			};
			
			if (iteration >= this.max_iterations) then{
				--is in set
				this.color = 1.0;
				1
			}else{
				--outside set
				this.color = 0.0;
				0
			}		
		}
	}

class List
	head : Node
	
	def init() : void{
		this.head = null
	}
	
	def insert(point : Point) : void{
		let
			new_node = new Node(point)
		in{
			if(this.head == null) then{
				this.head = new_node;
			}else{
				 get new_node.setNextNode(this.head);
				 this.head = new_node;
			}
		}
	}
	
	def print(n : int) : void{
		print("{},",n);
		get this.head.print();
	}
	
	
	
	def count() : int{
		if this.head != null then
			get this.head.count(0)
		else
			0
				  	
	}
	

	
	

class Node
	next : Node
	point : Point
	done : Fut int
	
	def init(point : Point) : void{
		this.next = null;
		this.point = point;
		this.done = point.compute_color();
	}
	
	def setNextNode(node : Node ) : void {
		this.next = node
	}
	
	def getNextNode() : Node{
		this.next
	}
	
	def getDone() : int{
		get this.done
	}
	
	def count(i : int) : int {
		if(this.next != null) then
			get this.next.count(i+1)
		else
			i+1
		
		}
	
	
	def print() : void{
		if(this.next == null )then{
			print("{}",get this.done);
		}else{
			print("{},",get this.done);
			get this.next.print();
		}
		
	
		
	}
	

	
	

	
	
	
	
	




































	
