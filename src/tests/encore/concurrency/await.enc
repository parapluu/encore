class Main
  def main() : void
    val t = new Test()
    t ! run1()
  end
end

class Producer
  def foo(t : Test) : int 
    get(t ! run2())
    17
  end
end

class Test 
  val p : Producer

  def init() : void
    this.p = new Producer
  end

  def run2() : void 
    print("While awaiting\n")
  end

  def run1() : void
    val f = this.p ! foo(this)
    print("Before await\n")
    this.await(f)
    print("After await\n")
    print("{}\n", get(f))
  end
end
