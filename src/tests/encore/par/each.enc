
class Main
  check_arr: [bool]
  size: int

  def setup(): void {
    this.size = 2000;
    this.check_arr = new [bool](this.size);
    for v in [0..this.size] this.check_arr[v] = false;
  }

  -- def assert_all(): void
  --   for v in this.check_arr assertTrue(v, "Expected 'true' value in test")

  -- def assert_limits(): void {
  --   assertTrue(this.check_arr[0], "Expected 'true' value in array with index: 0");
  --   assertTrue(this.check_arr[this.size],
  --              "Exprected 'true' value in array with index: {}", this.size);
  -- }

  def main(): void {
    this.setup();
    let rng = [0..this.size]
        arr = new [int](this.size)
        size = this.size
    in {
        for i in rng arr[i] = i;

        each(arr) >> (\(i: int) -> { this.check_arr[i] = true; i; } )
                  >> \(i: int) -> assertTrue(this.check_arr[i])

    -- TODO: these tests are affected by bug #434 (https://github.com/parapluu/encore/issues/434)
    --       until the bug is fixed, `extract` cannot be used in futures
        -- this.assert_limits();
        -- this.assert_all();
        };
  }
